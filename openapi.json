{"openapi":"3.1.0","info":{"title":"CLI Bridge API","version":"0.4.8","description":"Universal CLI Streaming Gateway for AI Coding Assistants. Provides HTTP and WebSocket APIs for interacting with Claude Code agents.","contact":{"name":"CLI Bridge Support"},"license":{"name":"MIT"}},"servers":[{"url":"http://172.20.0.2:3100","description":"QNAP Container (Production)"},{"url":"http://localhost:3100","description":"Local Development"}],"tags":[{"name":"Status","description":"Health and metrics endpoints"},{"name":"Configuration","description":"Server configuration"},{"name":"Agents","description":"Agent lifecycle management"},{"name":"Projects","description":"Project discovery and Git operations"},{"name":"Sessions","description":"Session management and history"},{"name":"Messages","description":"Message retrieval and pagination"},{"name":"Files","description":"File browsing within projects"},{"name":"Search","description":"Full-text search across sessions"},{"name":"Permissions","description":"Tool permission management"},{"name":"Images","description":"Image upload and management"},{"name":"Push","description":"Push notification management"},{"name":"WebSocket","description":"WebSocket protocol messages (schemas only - see ws://server:3100/ws)"}],"components":{"schemas":{"Error":{"type":"object","properties":{"error":{"type":"string","description":"Error message","example":"Session not found"},"code":{"type":"string","description":"Error code","example":"NOT_FOUND"},"details":{"type":"object","additionalProperties":{"nullable":true},"description":"Additional error details"}},"required":["error"]},"ValidationError":{"type":"object","properties":{"error":{"type":"string","enum":["VALIDATION_ERROR"],"description":"Error type"},"message":{"type":"string","description":"Human-readable error description","example":"Invalid session ID format"},"field":{"type":"string","description":"Field that failed validation","example":"sessionId"},"details":{"type":"array","items":{"type":"object","properties":{"field":{"type":"string"},"message":{"type":"string"}},"required":["field","message"]},"description":"Detailed validation errors"}},"required":["error","message"]},"NotFoundError":{"type":"object","properties":{"error":{"type":"string","enum":["NOT_FOUND"],"description":"Error type"},"message":{"type":"string","description":"Human-readable error description","example":"Session not found"},"resource":{"type":"string","description":"Type of resource that was not found","example":"session"},"id":{"type":"string","description":"ID of the resource that was not found"}},"required":["error","message"]},"RateLimitError":{"type":"object","properties":{"error":{"type":"string","enum":["RATE_LIMITED"],"description":"Error type"},"message":{"type":"string","description":"Human-readable error description","example":"Too many requests"},"retryAfter":{"type":"integer","description":"Seconds to wait before retrying","example":60},"limit":{"type":"integer","description":"Request limit","example":100},"remaining":{"type":"integer","description":"Remaining requests in window","example":0}},"required":["error","message","retryAfter"]},"ServerError":{"type":"object","properties":{"error":{"type":"string","enum":["SERVER_ERROR"],"description":"Error type"},"message":{"type":"string","description":"Human-readable error description","example":"Internal server error"},"requestId":{"type":"string","description":"Request ID for debugging"}},"required":["error","message"]},"PaginationError":{"type":"object","properties":{"code":{"type":"string","enum":["CURSOR_NOT_FOUND","CURSOR_EXPIRED","INVALID_PARAMS"],"description":"Error code"},"cursorId":{"type":"string","description":"The cursor ID that caused the error"},"maxAge":{"type":"integer","description":"Maximum cursor age in seconds"},"message":{"type":"string","description":"Error message"}},"required":["code"]},"PaginationInfo":{"type":"object","properties":{"total":{"type":"integer","description":"Total items matching filter","example":42},"limit":{"type":"integer","description":"Items per page","example":25},"offset":{"type":"integer","description":"Items skipped","example":0},"hasMore":{"type":"boolean","description":"Whether more items exist","example":true},"nextCursor":{"type":"string","format":"uuid","description":"Cursor for next page"},"prevCursor":{"type":"string","format":"uuid","description":"Cursor for previous page"}},"required":["total","limit","offset","hasMore"]},"IntegrityInfo":{"type":"object","properties":{"totalLines":{"type":"integer","description":"Total lines processed from history file"},"validLines":{"type":"integer","description":"Lines that parsed successfully"},"corruptedLines":{"type":"integer","description":"Lines that failed to parse"},"corruptedSamples":{"type":"array","items":{"type":"string"},"description":"Sample of corrupted line content"}},"required":["totalLines","validLines","corruptedLines","corruptedSamples"]},"BulkOperationResult":{"type":"object","properties":{"success":{"type":"array","items":{"type":"string"},"description":"Session IDs that succeeded"},"failed":{"type":"array","items":{"type":"object","properties":{"sessionId":{"type":"string"},"error":{"type":"string"}},"required":["sessionId","error"]},"description":"Sessions that failed with error details"}},"required":["success","failed"]},"FileEntryType":{"type":"string","enum":["file","directory","symlink"]},"FileErrorCode":{"type":"string","enum":["PATH_FORBIDDEN","NOT_FOUND","NOT_DIRECTORY","BINARY_FILE","FILE_TOO_LARGE"]},"FileEntry":{"type":"object","properties":{"name":{"type":"string","description":"File or directory name","example":"package.json"},"type":{"allOf":[{"$ref":"#/components/schemas/FileEntryType"},{"description":"Entry type"}]},"size":{"type":"integer","description":"Size in bytes (files only)","example":1024},"modified":{"type":"string","description":"ISO 8601 timestamp of last modification","example":"2024-01-15T10:30:00Z"}},"required":["name","type","modified"]},"DirectoryListing":{"type":"object","properties":{"path":{"type":"string","description":"Path relative to project root","example":"/src"},"entries":{"type":"array","items":{"$ref":"#/components/schemas/FileEntry"},"description":"Directory entries"}},"required":["path","entries"]},"FileContent":{"type":"object","properties":{"path":{"type":"string","description":"Path relative to project root","example":"/src/main.ts"},"content":{"type":"string","description":"File text content"},"size":{"type":"integer","description":"File size in bytes","example":2048},"modified":{"type":"string","description":"ISO 8601 timestamp of last modification","example":"2024-01-15T10:30:00Z"},"mimeType":{"type":"string","description":"MIME type of the file","example":"text/typescript"}},"required":["path","content","size","modified","mimeType"]},"FileErrorResponse":{"type":"object","properties":{"error":{"allOf":[{"$ref":"#/components/schemas/FileErrorCode"},{"description":"Error code"}]},"isBinary":{"type":"boolean","description":"True if file is binary (for BINARY_FILE error)"},"tooLarge":{"type":"boolean","description":"True if file exceeds size limit (for FILE_TOO_LARGE error)"},"size":{"type":"integer","description":"Actual file size in bytes (for FILE_TOO_LARGE error)"}},"required":["error"]},"PushEnvironment":{"type":"string","enum":["sandbox","production"]},"TokenType":{"type":"string","enum":["fcm","live_activity"]},"RegisterFcmRequest":{"type":"object","properties":{"fcmToken":{"type":"string","minLength":1,"description":"Firebase Cloud Messaging token","example":"dGVzdC10b2tlbi1mb3ItZGV2ZWxvcG1lbnQ..."},"platform":{"type":"string","enum":["ios"],"description":"Platform (currently only iOS supported)"},"environment":{"allOf":[{"$ref":"#/components/schemas/PushEnvironment"},{"default":"production","description":"APNs environment"}]},"appVersion":{"type":"string","description":"App version string","example":"1.2.3"},"osVersion":{"type":"string","description":"OS version string","example":"17.2"}},"required":["fcmToken","platform"]},"RegisterFcmResponse":{"type":"object","properties":{"success":{"type":"boolean","enum":[true],"description":"Registration success indicator"},"tokenId":{"type":"string","description":"Registered token ID","example":"push_abc123"}},"required":["success","tokenId"]},"RegisterLiveActivityRequest":{"type":"object","properties":{"pushToken":{"type":"string","minLength":1,"description":"APNs push token for Live Activity updates"},"pushToStartToken":{"type":"string","description":"APNs push-to-start token (optional)"},"activityId":{"type":"string","minLength":1,"description":"Unique Live Activity identifier from iOS","example":"activity_xyz789"},"sessionId":{"type":"string","format":"uuid","description":"CLI Bridge session ID this activity tracks"},"attributesType":{"type":"string","description":"ActivityAttributes type name","example":"SessionActivityAttributes"},"platform":{"type":"string","enum":["ios"],"description":"Platform (defaults to iOS)"},"environment":{"allOf":[{"$ref":"#/components/schemas/PushEnvironment"},{"default":"production","description":"APNs environment"}]}},"required":["pushToken","activityId","sessionId"]},"RegisterLiveActivityResponse":{"type":"object","properties":{"success":{"type":"boolean","enum":[true],"description":"Registration success indicator"},"activityTokenId":{"type":"string","description":"Registered activity token ID","example":"push_la_def456"}},"required":["success","activityTokenId"]},"InvalidateTokenRequest":{"type":"object","properties":{"tokenType":{"allOf":[{"$ref":"#/components/schemas/TokenType"},{"description":"Type of token to invalidate"}]},"token":{"type":"string","minLength":1,"description":"The token value to invalidate"}},"required":["tokenType","token"]},"InvalidateTokenResponse":{"type":"object","properties":{"success":{"type":"boolean","enum":[true],"description":"Invalidation success indicator"}},"required":["success"]},"LiveActivityTokenInfo":{"type":"object","properties":{"activityId":{"type":"string","description":"Live Activity identifier"},"sessionId":{"type":"string","description":"Associated session ID"},"registeredAt":{"type":"string","description":"ISO 8601 registration timestamp"},"hasUpdateToken":{"type":"boolean","description":"Has APNs update token"},"hasPushToStartToken":{"type":"boolean","description":"Has push-to-start token"}},"required":["activityId","sessionId","registeredAt","hasUpdateToken","hasPushToStartToken"]},"RecentDelivery":{"type":"object","properties":{"type":{"type":"string","description":"Notification type"},"sentAt":{"type":"string","description":"ISO 8601 send timestamp"},"success":{"type":"boolean","description":"Delivery success"}},"required":["type","sentAt","success"]},"PushStatusResponse":{"type":"object","properties":{"provider":{"type":"string","description":"Push provider name","example":"firebase"},"providerEnabled":{"type":"boolean","description":"Whether provider is enabled"},"fcmTokenRegistered":{"type":"boolean","description":"Whether FCM token is registered"},"fcmTokenLastUpdated":{"type":"string","description":"ISO 8601 timestamp of last FCM token update"},"liveActivityTokens":{"type":"array","items":{"$ref":"#/components/schemas/LiveActivityTokenInfo"},"description":"Registered Live Activity tokens"},"recentDeliveries":{"type":"array","items":{"$ref":"#/components/schemas/RecentDelivery"},"description":"Recent delivery attempts"}},"required":["provider","providerEnabled","fcmTokenRegistered","liveActivityTokens","recentDeliveries"]},"PushTestType":{"type":"string","enum":["notification","live_activity_update","live_activity_end"]},"PushTestRequest":{"type":"object","properties":{"type":{"allOf":[{"$ref":"#/components/schemas/PushTestType"},{"description":"Type of push notification to test"}]},"payload":{"type":"object","additionalProperties":{"nullable":true},"description":"Payload data. For notification: {title, body}. For live_activity_*: {sessionId, operation?}","example":{"title":"Test","body":"Test notification"}}},"required":["type","payload"]},"PushTestResponse":{"type":"object","properties":{"wouldSend":{"type":"boolean","enum":[true],"description":"Indicates a notification would be sent"},"payload":{"type":"object","additionalProperties":{"nullable":true},"description":"The payload that would be sent"},"targetTokens":{"type":"array","items":{"type":"string"},"description":"Truncated tokens that would receive the notification"},"result":{"nullable":true,"description":"Result from the push operation"}},"required":["wouldSend","payload","targetTokens"]},"PushErrorResponse":{"type":"object","properties":{"error":{"type":"string","description":"Error code","example":"UNAUTHORIZED"},"message":{"type":"string","description":"Human-readable error message"}},"required":["error","message"]},"ImageAttachment":{"type":"object","properties":{"type":{"type":"string","enum":["base64","reference"],"description":"Type of image attachment"},"data":{"type":"string","description":"Base64-encoded image data (for base64 type)"},"id":{"type":"string","description":"Image reference ID from upload (for reference type)"},"mimeType":{"type":"string","description":"MIME type (e.g., image/png)","example":"image/png"}},"required":["type"]},"StartMessage":{"type":"object","properties":{"type":{"type":"string","enum":["start"]},"projectPath":{"type":"string","description":"Absolute path to project directory","example":"/Users/dev/my-project"},"sessionId":{"type":"string","format":"uuid","description":"Resume existing session by UUID"},"model":{"type":"string","description":"Model override","example":"sonnet"},"helper":{"type":"boolean","description":"Enable helper mode for quick queries"}},"required":["type","projectPath"]},"InputMessage":{"type":"object","properties":{"type":{"type":"string","enum":["input"]},"text":{"type":"string","description":"User message content"},"images":{"type":"array","items":{"$ref":"#/components/schemas/ImageAttachment"},"description":"Optional image attachments"},"messageId":{"type":"string","description":"Client-provided ID for retry correlation"},"thinkingMode":{"type":"string","nullable":true,"description":"Extended thinking mode (e.g., think, think_hard, think_harder, ultrathink)"}},"required":["type","text"]},"PermissionResponseMessage":{"type":"object","properties":{"type":{"type":"string","enum":["permission_response"]},"id":{"type":"string","description":"Permission request ID to respond to"},"choice":{"type":"string","enum":["allow","deny","always"],"description":"User's permission choice"}},"required":["type","id","choice"]},"QuestionResponseMessage":{"type":"object","properties":{"type":{"type":"string","enum":["question_response"]},"id":{"type":"string","description":"Question ID to respond to"},"answers":{"type":"object","additionalProperties":{"anyOf":[{"type":"string"},{"type":"array","items":{"type":"string"}}]},"description":"Map of question text to answer(s)"}},"required":["type","id","answers"]},"InterruptMessage":{"type":"object","properties":{"type":{"type":"string","enum":["interrupt"]}},"required":["type"]},"StopMessage":{"type":"object","properties":{"type":{"type":"string","enum":["stop"]}},"required":["type"]},"SubscribeSessionsMessage":{"type":"object","properties":{"type":{"type":"string","enum":["subscribe_sessions"]},"projectPath":{"type":"string","description":"Filter to specific project"}},"required":["type"]},"SetModelMessage":{"type":"object","properties":{"type":{"type":"string","enum":["set_model"]},"model":{"type":"string","description":"Model ID to switch to","example":"sonnet"}},"required":["type","model"]},"SetPermissionModeMessage":{"type":"object","properties":{"type":{"type":"string","enum":["set_permission_mode"]},"mode":{"type":"string","enum":["default","acceptEdits","bypassPermissions"],"description":"Permission handling mode"}},"required":["type","mode"]},"CancelQueuedMessage":{"type":"object","properties":{"type":{"type":"string","enum":["cancel_queued"]}},"required":["type"]},"RetryMessage":{"type":"object","properties":{"type":{"type":"string","enum":["retry"]},"messageId":{"type":"string","description":"ID of failed message to retry (defaults to last failed)"}},"required":["type"]},"PingMessage":{"type":"object","properties":{"type":{"type":"string","enum":["ping"]}},"required":["type"]},"ClientPongMessage":{"type":"object","properties":{"type":{"type":"string","enum":["pong"]}},"required":["type"]},"ReconnectMessage":{"type":"object","properties":{"type":{"type":"string","enum":["reconnect"]},"agentId":{"type":"string","description":"Agent ID to reconnect to"},"lastMessageId":{"type":"string","description":"Resume from this message ID"}},"required":["type","agentId"]},"ClientMessage":{"oneOf":[{"$ref":"#/components/schemas/StartMessage"},{"$ref":"#/components/schemas/InputMessage"},{"$ref":"#/components/schemas/PermissionResponseMessage"},{"$ref":"#/components/schemas/QuestionResponseMessage"},{"$ref":"#/components/schemas/InterruptMessage"},{"$ref":"#/components/schemas/StopMessage"},{"$ref":"#/components/schemas/SubscribeSessionsMessage"},{"$ref":"#/components/schemas/SetModelMessage"},{"$ref":"#/components/schemas/SetPermissionModeMessage"},{"$ref":"#/components/schemas/CancelQueuedMessage"},{"$ref":"#/components/schemas/RetryMessage"},{"$ref":"#/components/schemas/PingMessage"},{"$ref":"#/components/schemas/ClientPongMessage"},{"$ref":"#/components/schemas/ReconnectMessage"}],"discriminator":{"propertyName":"type","mapping":{"start":"#/components/schemas/StartMessage","input":"#/components/schemas/InputMessage","permission_response":"#/components/schemas/PermissionResponseMessage","question_response":"#/components/schemas/QuestionResponseMessage","interrupt":"#/components/schemas/InterruptMessage","stop":"#/components/schemas/StopMessage","subscribe_sessions":"#/components/schemas/SubscribeSessionsMessage","set_model":"#/components/schemas/SetModelMessage","set_permission_mode":"#/components/schemas/SetPermissionModeMessage","cancel_queued":"#/components/schemas/CancelQueuedMessage","retry":"#/components/schemas/RetryMessage","ping":"#/components/schemas/PingMessage","pong":"#/components/schemas/ClientPongMessage","reconnect":"#/components/schemas/ReconnectMessage"}}},"ConnectedMessage":{"type":"object","properties":{"type":{"type":"string","enum":["connected"]},"agentId":{"type":"string","description":"CLI Bridge agent ID"},"sessionId":{"type":"string","format":"uuid","description":"Claude session UUID"},"model":{"type":"string","description":"Active model (alias or full ID)"},"modelAlias":{"type":"string","description":"Model alias echoed back from client request (e.g., 'sonnet', 'opus', 'haiku')"},"version":{"type":"string","description":"Server version"},"protocolVersion":{"type":"string","enum":["1.0"],"description":"Protocol version for client compatibility"}},"required":["type","agentId","sessionId","model","version","protocolVersion"]},"QuestionOption":{"type":"object","properties":{"label":{"type":"string","description":"Display label"},"description":{"type":"string","description":"Option description"}},"required":["label"]},"QuestionItem":{"type":"object","properties":{"question":{"type":"string","description":"Question text"},"header":{"type":"string","description":"Short header/label"},"options":{"type":"array","items":{"$ref":"#/components/schemas/QuestionOption"},"description":"Available options"},"multiSelect":{"type":"boolean","description":"Allow multiple selections"}},"required":["question","header","options","multiSelect"]},"PermissionRequestMessage":{"type":"object","properties":{"type":{"type":"string","enum":["permission"]},"id":{"type":"string","description":"Request ID for response correlation"},"tool":{"type":"string","description":"Tool requesting permission"},"input":{"type":"object","additionalProperties":{"nullable":true},"description":"Tool input parameters"},"options":{"type":"array","items":{"type":"string","enum":["allow","deny","always"]},"description":"Available permission choices"}},"required":["type","id","tool","input","options"]},"QuestionMessage":{"type":"object","properties":{"type":{"type":"string","enum":["question"]},"id":{"type":"string","description":"Question ID for response"},"questions":{"type":"array","items":{"$ref":"#/components/schemas/QuestionItem"},"description":"Array of questions"}},"required":["type","id","questions"]},"SessionEventMessage":{"type":"object","properties":{"type":{"type":"string","enum":["session_event"]},"action":{"type":"string","enum":["created","updated","deleted"],"description":"Event type"},"projectPath":{"type":"string","description":"Project path"},"sessionId":{"type":"string","format":"uuid","description":"Session ID"},"metadata":{"type":"object","properties":{"id":{"type":"string","format":"uuid"},"projectPath":{"type":"string"},"source":{"type":"string","enum":["user","agent","helper"]},"createdAt":{"type":"string","format":"date-time"},"lastActivityAt":{"type":"string","format":"date-time"},"messageCount":{"type":"integer"},"title":{"type":"string"},"summary":{"type":"string"},"customTitle":{"type":"string"},"model":{"type":"string"},"archivedAt":{"type":"string","format":"date-time"},"parentSessionId":{"type":"string","format":"uuid"}},"required":["id","projectPath","source","lastActivityAt","messageCount"],"description":"Session metadata (for created/updated)"}},"required":["type","action","projectPath","sessionId"]},"ModelChangedMessage":{"type":"object","properties":{"type":{"type":"string","enum":["model_changed"]},"model":{"type":"string","description":"New model"},"previousModel":{"type":"string","description":"Previous model"}},"required":["type","model","previousModel"]},"PermissionModeChangedMessage":{"type":"object","properties":{"type":{"type":"string","enum":["permission_mode_changed"]},"mode":{"type":"string","enum":["default","acceptEdits","bypassPermissions"],"description":"New permission mode"}},"required":["type","mode"]},"StoppedMessage":{"type":"object","properties":{"type":{"type":"string","enum":["stopped"]},"reason":{"type":"string","enum":["user","complete","error","timeout"],"description":"Stop reason"}},"required":["type","reason"]},"InterruptedMessage":{"type":"object","properties":{"type":{"type":"string","enum":["interrupted"]}},"required":["type"]},"PongMessage":{"type":"object","properties":{"type":{"type":"string","enum":["pong"]},"serverTime":{"type":"number","description":"Server timestamp (epoch ms)"}},"required":["type","serverTime"]},"ServerPingMessage":{"type":"object","properties":{"type":{"type":"string","enum":["ping"]},"serverTime":{"type":"number","description":"Server timestamp (epoch ms)"}},"required":["type","serverTime"]},"WsErrorMessage":{"type":"object","properties":{"type":{"type":"string","enum":["error"]},"code":{"type":"string","description":"Error code","example":"AGENT_NOT_FOUND"},"message":{"type":"string","description":"Human-readable description"},"recoverable":{"type":"boolean","description":"Whether client can continue"},"retryable":{"type":"boolean","description":"Whether operation can be retried"},"retryAfter":{"type":"number","description":"Seconds to wait before retry"}},"required":["type","code","message","recoverable"]},"QueuedMessage":{"type":"object","properties":{"type":{"type":"string","enum":["queued"]},"position":{"type":"integer","description":"Position in queue (1 = next)"}},"required":["type","position"]},"QueueClearedMessage":{"type":"object","properties":{"type":{"type":"string","enum":["queue_cleared"]}},"required":["type"]},"CursorEvictedMessage":{"type":"object","properties":{"type":{"type":"string","enum":["cursor_evicted"]},"lastMessageId":{"type":"string","description":"The evicted cursor ID"},"recommendation":{"type":"string","enum":["fetch_from_rest"],"description":"Client should use REST API"}},"required":["type","lastMessageId","recommendation"]},"CursorInvalidMessage":{"type":"object","properties":{"type":{"type":"string","enum":["cursor_invalid"]},"lastMessageId":{"type":"string","description":"The invalid cursor ID"},"recommendation":{"type":"string","enum":["full_resync"],"description":"Client needs full resync"}},"required":["type","lastMessageId","recommendation"]},"ReconnectCompleteMessage":{"type":"object","properties":{"type":{"type":"string","enum":["reconnect_complete"]},"missedCount":{"type":"integer","description":"Number of messages replayed"},"fromMessageId":{"type":"string","description":"Starting message ID"}},"required":["type","missedCount","fromMessageId"]},"AssistantStreamMessage":{"type":"object","properties":{"type":{"type":"string","enum":["assistant"]},"content":{"type":"string","description":"Claude's text output"},"delta":{"type":"boolean","description":"True for streaming chunks"}},"required":["type","content"]},"UserStreamMessage":{"type":"object","properties":{"type":{"type":"string","enum":["user"]},"content":{"type":"string","description":"User's text input (echoed back)"}},"required":["type","content"]},"SystemStreamMessage":{"type":"object","properties":{"type":{"type":"string","enum":["system"]},"content":{"type":"string","description":"System notification content"},"subtype":{"type":"string","enum":["init","result","progress"],"description":"System message subtype"}},"required":["type","content"]},"ToolResultInline":{"type":"object","nullable":true,"properties":{"output":{"type":"string","description":"Tool output"},"success":{"type":"boolean","description":"Whether tool succeeded"},"isError":{"type":"boolean","description":"Whether output is error message"}},"required":["output","success"],"description":"Denormalized result (history API with denormalize=true)"},"ToolUseStreamMessage":{"type":"object","properties":{"type":{"type":"string","enum":["tool_use"]},"id":{"type":"string","description":"Unique tool call ID"},"name":{"type":"string","description":"Tool being invoked"},"input":{"type":"object","additionalProperties":{"nullable":true},"description":"Tool parameters"},"inputDescription":{"type":"string","description":"Human-readable description of tool input (e.g., 'Run command: ls -la')"},"result":{"$ref":"#/components/schemas/ToolResultInline"}},"required":["type","id","name","input"]},"ToolResultStreamMessage":{"type":"object","properties":{"type":{"type":"string","enum":["tool_result"]},"id":{"type":"string","description":"Correlates to tool_use.id"},"tool":{"type":"string","description":"Tool name for display"},"output":{"type":"string","description":"Result content"},"success":{"type":"boolean","description":"Whether tool succeeded"},"isError":{"type":"boolean","description":"Whether output is error message"}},"required":["type","id","tool","output","success"]},"ProgressStreamMessage":{"type":"object","properties":{"type":{"type":"string","enum":["progress"]},"id":{"type":"string","description":"Correlates to tool_use.id"},"tool":{"type":"string","description":"Tool name"},"elapsed":{"type":"number","description":"Seconds since start"},"progress":{"type":"number","minimum":0,"maximum":100,"description":"0-100 if measurable"},"detail":{"type":"string","description":"Human-readable status","example":"Running test 5 of 20"}},"required":["type","id","tool","elapsed"]},"SubagentStartStreamMessage":{"type":"object","properties":{"type":{"type":"string","enum":["subagent_start"]},"id":{"type":"string","description":"Unique subagent ID"},"description":{"type":"string","description":"What the subagent is doing"}},"required":["type","id","description"]},"SubagentCompleteStreamMessage":{"type":"object","properties":{"type":{"type":"string","enum":["subagent_complete"]},"id":{"type":"string","description":"Correlates to subagent_start.id"},"summary":{"type":"string","description":"Brief summary of results"}},"required":["type","id"]},"UsageStreamMessage":{"type":"object","properties":{"type":{"type":"string","enum":["usage"]},"inputTokens":{"type":"integer","description":"Input token count"},"outputTokens":{"type":"integer","description":"Output token count"},"cacheReadTokens":{"type":"integer","description":"Tokens served from cache"},"cacheCreateTokens":{"type":"integer","description":"Tokens written to cache"},"totalCost":{"type":"number","description":"Estimated cost"},"contextUsed":{"type":"integer","description":"Cumulative tokens in context"},"contextLimit":{"type":"integer","description":"Max context window"}},"required":["type","inputTokens","outputTokens"]},"StateStreamMessage":{"type":"object","properties":{"type":{"type":"string","enum":["state"]},"state":{"type":"string","enum":["thinking","executing","waiting_input","waiting_permission","idle","recovering"],"description":"Current agent state"},"tool":{"type":"string","description":"Tool name if executing"}},"required":["type","state"]},"ThinkingStreamMessage":{"type":"object","properties":{"type":{"type":"string","enum":["thinking"]},"content":{"type":"string","description":"Extended thinking content from Claude"},"thinking":{"type":"string","description":"Alias for content (for compatibility with ContentBlock format)"}},"required":["type","content"]},"StreamMessage":{"oneOf":[{"$ref":"#/components/schemas/AssistantStreamMessage"},{"$ref":"#/components/schemas/UserStreamMessage"},{"$ref":"#/components/schemas/SystemStreamMessage"},{"$ref":"#/components/schemas/ToolUseStreamMessage"},{"$ref":"#/components/schemas/ToolResultStreamMessage"},{"$ref":"#/components/schemas/ProgressStreamMessage"},{"$ref":"#/components/schemas/SubagentStartStreamMessage"},{"$ref":"#/components/schemas/SubagentCompleteStreamMessage"},{"$ref":"#/components/schemas/UsageStreamMessage"},{"$ref":"#/components/schemas/StateStreamMessage"},{"$ref":"#/components/schemas/ThinkingStreamMessage"},{"$ref":"#/components/schemas/PermissionRequestMessage"},{"$ref":"#/components/schemas/QuestionMessage"}],"discriminator":{"propertyName":"type","mapping":{"assistant":"#/components/schemas/AssistantStreamMessage","user":"#/components/schemas/UserStreamMessage","system":"#/components/schemas/SystemStreamMessage","tool_use":"#/components/schemas/ToolUseStreamMessage","tool_result":"#/components/schemas/ToolResultStreamMessage","progress":"#/components/schemas/ProgressStreamMessage","subagent_start":"#/components/schemas/SubagentStartStreamMessage","subagent_complete":"#/components/schemas/SubagentCompleteStreamMessage","usage":"#/components/schemas/UsageStreamMessage","state":"#/components/schemas/StateStreamMessage","thinking":"#/components/schemas/ThinkingStreamMessage","permission":"#/components/schemas/PermissionRequestMessage","question":"#/components/schemas/QuestionMessage"}}},"HistoryMessage":{"type":"object","properties":{"type":{"type":"string","enum":["history"]},"messages":{"type":"array","items":{"$ref":"#/components/schemas/StreamMessage"},"description":"Array of stream messages"},"hasMore":{"type":"boolean","description":"More messages available"},"cursor":{"type":"string","description":"Pagination cursor"}},"required":["type","messages","hasMore"]},"StreamServerMessage":{"type":"object","properties":{"type":{"type":"string","enum":["stream"]},"id":{"type":"string","format":"uuid","description":"Unique message identifier"},"timestamp":{"type":"string","format":"date-time","description":"ISO-8601 timestamp"},"message":{"allOf":[{"$ref":"#/components/schemas/StreamMessage"},{"description":"The message content"}]}},"required":["type","id","timestamp","message"]},"ErrorMessage":{"type":"object","properties":{"type":{"type":"string","enum":["error"]},"code":{"type":"string","description":"Error code","example":"AGENT_NOT_FOUND"},"message":{"type":"string","description":"Human-readable description"},"recoverable":{"type":"boolean","description":"Whether client can continue"},"retryable":{"type":"boolean","description":"Whether operation can be retried"},"retryAfter":{"type":"number","description":"Seconds to wait before retry"}},"required":["type","code","message","recoverable"]},"ServerMessage":{"oneOf":[{"$ref":"#/components/schemas/ConnectedMessage"},{"$ref":"#/components/schemas/StreamServerMessage"},{"$ref":"#/components/schemas/PermissionRequestMessage"},{"$ref":"#/components/schemas/QuestionMessage"},{"$ref":"#/components/schemas/SessionEventMessage"},{"$ref":"#/components/schemas/ModelChangedMessage"},{"$ref":"#/components/schemas/PermissionModeChangedMessage"},{"$ref":"#/components/schemas/QueuedMessage"},{"$ref":"#/components/schemas/QueueClearedMessage"},{"$ref":"#/components/schemas/HistoryMessage"},{"$ref":"#/components/schemas/StoppedMessage"},{"$ref":"#/components/schemas/InterruptedMessage"},{"$ref":"#/components/schemas/ServerPingMessage"},{"$ref":"#/components/schemas/PongMessage"},{"$ref":"#/components/schemas/ErrorMessage"},{"$ref":"#/components/schemas/CursorEvictedMessage"},{"$ref":"#/components/schemas/CursorInvalidMessage"},{"$ref":"#/components/schemas/ReconnectCompleteMessage"}],"discriminator":{"propertyName":"type","mapping":{"connected":"#/components/schemas/ConnectedMessage","stream":"#/components/schemas/StreamServerMessage","permission":"#/components/schemas/PermissionRequestMessage","question":"#/components/schemas/QuestionMessage","session_event":"#/components/schemas/SessionEventMessage","model_changed":"#/components/schemas/ModelChangedMessage","permission_mode_changed":"#/components/schemas/PermissionModeChangedMessage","queued":"#/components/schemas/QueuedMessage","queue_cleared":"#/components/schemas/QueueClearedMessage","history":"#/components/schemas/HistoryMessage","stopped":"#/components/schemas/StoppedMessage","interrupted":"#/components/schemas/InterruptedMessage","ping":"#/components/schemas/ServerPingMessage","pong":"#/components/schemas/PongMessage","error":"#/components/schemas/ErrorMessage","cursor_evicted":"#/components/schemas/CursorEvictedMessage","cursor_invalid":"#/components/schemas/CursorInvalidMessage","reconnect_complete":"#/components/schemas/ReconnectCompleteMessage"}}},"TextBlock":{"type":"object","properties":{"type":{"type":"string","enum":["text"]},"text":{"type":"string","description":"Text content"}},"required":["type","text"]},"ToolUseBlock":{"type":"object","properties":{"type":{"type":"string","enum":["tool_use"]},"id":{"type":"string","description":"Tool call ID"},"name":{"type":"string","description":"Tool name"},"input":{"type":"object","additionalProperties":{"nullable":true},"description":"Tool input parameters"}},"required":["type","id","name","input"]},"ToolResultBlock":{"type":"object","properties":{"type":{"type":"string","enum":["tool_result"]},"tool_use_id":{"type":"string","description":"Correlates to tool_use.id"},"content":{"type":"string","description":"Result content"},"is_error":{"type":"boolean","description":"Whether result is an error"}},"required":["type","tool_use_id","content"]},"ThinkingBlock":{"type":"object","properties":{"type":{"type":"string","enum":["thinking"]},"thinking":{"type":"string","description":"Thinking content"}},"required":["type","thinking"]},"ContentBlock":{"oneOf":[{"$ref":"#/components/schemas/TextBlock"},{"$ref":"#/components/schemas/ToolUseBlock"},{"$ref":"#/components/schemas/ToolResultBlock"},{"$ref":"#/components/schemas/ThinkingBlock"}],"discriminator":{"propertyName":"type","mapping":{"text":"#/components/schemas/TextBlock","tool_use":"#/components/schemas/ToolUseBlock","tool_result":"#/components/schemas/ToolResultBlock","thinking":"#/components/schemas/ThinkingBlock"}}},"StoredMessage":{"type":"object","properties":{"id":{"type":"string","format":"uuid","description":"Unique message identifier"},"timestamp":{"type":"string","format":"date-time","description":"ISO-8601 timestamp"},"message":{"allOf":[{"$ref":"#/components/schemas/StreamMessage"},{"description":"The message content"}]},"rawContent":{"type":"array","items":{"$ref":"#/components/schemas/ContentBlock"},"description":"Structured content blocks (for tool_use, thinking, etc.)"}},"required":["id","timestamp","message"]},"SearchSnippet":{"type":"object","properties":{"type":{"type":"string","description":"Message type (user, assistant, etc.)","example":"assistant"},"text":{"type":"string","description":"The matched text with surrounding context","example":"...implementing the feature..."},"matchStart":{"type":"integer","description":"Position of match within text","example":10},"matchLength":{"type":"integer","description":"Length of match","example":7}},"required":["type","text","matchStart","matchLength"]},"SearchResult":{"type":"object","properties":{"sessionId":{"type":"string","format":"uuid","description":"Session ID","example":"550e8400-e29b-41d4-a716-446655440000"},"projectPath":{"type":"string","description":"Project path","example":"/Users/dev/my-project"},"snippets":{"type":"array","items":{"$ref":"#/components/schemas/SearchSnippet"},"description":"Matching content snippets with context"},"score":{"type":"number","description":"Relevance score (higher = more relevant)","example":42.5},"timestamp":{"type":"string","description":"Session timestamp","example":"2024-01-15T10:30:00Z"}},"required":["sessionId","projectPath","snippets","score","timestamp"]},"SearchResponse":{"type":"object","properties":{"query":{"type":"string","description":"Search query","example":"authentication"},"total":{"type":"integer","description":"Total number of matches","example":15},"results":{"type":"array","items":{"$ref":"#/components/schemas/SearchResult"},"description":"Paginated results"},"hasMore":{"type":"boolean","description":"Whether there are more results","example":true}},"required":["query","total","results","hasMore"]},"SearchErrorCode":{"type":"string","enum":["MISSING_QUERY","INVALID_LIMIT","INVALID_OFFSET"]},"SearchErrorResponse":{"type":"object","properties":{"error":{"allOf":[{"$ref":"#/components/schemas/SearchErrorCode"},{"description":"Error code"}]},"message":{"type":"string","description":"Human-readable error message"}},"required":["error","message"]},"PermissionMode":{"type":"string","enum":["default","acceptEdits","bypassPermissions"]},"GlobalPermissions":{"type":"object","properties":{"bypass_all":{"type":"boolean","description":"Bypass all permission checks globally","example":false},"default_mode":{"allOf":[{"$ref":"#/components/schemas/PermissionMode"},{"description":"Default permission mode for all projects"}]}},"required":["bypass_all","default_mode"]},"ProjectPermissions":{"type":"object","properties":{"permission_mode":{"allOf":[{"$ref":"#/components/schemas/PermissionMode"},{"description":"Override permission mode for this project"}]},"bypass_all":{"type":"boolean","description":"Bypass all permission checks for this project"},"always_allow":{"type":"array","items":{"type":"string"},"description":"Tools always allowed without prompting","example":["Read","Glob","Grep"]},"always_deny":{"type":"array","items":{"type":"string"},"description":"Tools always denied","example":["Bash"]}}},"PermissionConfig":{"type":"object","properties":{"global":{"allOf":[{"$ref":"#/components/schemas/GlobalPermissions"},{"description":"Global permission settings"}]},"projects":{"type":"object","additionalProperties":{"$ref":"#/components/schemas/ProjectPermissions"},"description":"Per-project permission overrides keyed by project path"}},"required":["global","projects"]},"UpdatePermissionConfig":{"type":"object","properties":{"global":{"allOf":[{"$ref":"#/components/schemas/GlobalPermissions"},{"description":"Global settings to update"}]},"projects":{"type":"object","additionalProperties":{"$ref":"#/components/schemas/ProjectPermissions"},"description":"Project settings to update (merged with existing)"}}},"PermissionSuccessResponse":{"type":"object","properties":{"success":{"type":"boolean","enum":[true],"description":"Operation success indicator"}},"required":["success"]},"PermissionErrorResponse":{"type":"object","properties":{"error":{"type":"string","description":"Error message","example":"Invalid JSON body"}},"required":["error"]},"GitStatus":{"type":"object","properties":{"branch":{"type":"string","description":"Current branch name","example":"main"},"isClean":{"type":"boolean","description":"No uncommitted changes","example":true},"uncommittedCount":{"type":"integer","description":"Number of changed files","example":0},"ahead":{"type":"integer","description":"Commits ahead of remote","example":0},"behind":{"type":"integer","description":"Commits behind remote","example":0},"hasUntracked":{"type":"boolean","description":"Has untracked files"},"hasStaged":{"type":"boolean","description":"Has staged changes"},"remote":{"type":"string","description":"Remote name","example":"origin"},"trackingBranch":{"type":"string","description":"Tracking branch","example":"origin/main"}},"required":["branch","isClean"]},"Project":{"type":"object","properties":{"path":{"type":"string","description":"Absolute path to project","example":"/Users/dev/my-project"},"name":{"type":"string","description":"Directory name","example":"my-project"},"lastUsed":{"type":"string","format":"date-time","description":"Last activity timestamp"},"sessionCount":{"type":"integer","description":"Number of sessions","example":5},"git":{"allOf":[{"$ref":"#/components/schemas/GitStatus"},{"description":"Git repository status"}]}},"required":["path","name"]},"ProjectListResponse":{"type":"object","properties":{"projects":{"type":"array","items":{"$ref":"#/components/schemas/Project"},"description":"List of discovered projects"}},"required":["projects"]},"SubRepo":{"type":"object","properties":{"relativePath":{"type":"string","description":"Relative path from project root","example":"packages/ui"},"git":{"allOf":[{"$ref":"#/components/schemas/GitStatus"},{"description":"Git status of the sub-repository"}]}},"required":["relativePath","git"]},"SubReposListResponse":{"type":"object","properties":{"subrepos":{"type":"array","items":{"$ref":"#/components/schemas/SubRepo"},"description":"List of sub-repositories"}},"required":["subrepos"]},"GitPullResult":{"type":"object","properties":{"success":{"type":"boolean","description":"Whether the pull succeeded","example":true},"message":{"type":"string","description":"Pull result message","example":"Fast-forward"},"commits":{"type":"integer","description":"Number of commits pulled","example":3},"files":{"type":"array","items":{"type":"string"},"description":"Files changed (if any)","example":["src/main.ts","README.md"]},"conflict":{"type":"boolean","description":"True if merge conflicts detected"}},"required":["success","message","commits"]},"ProjectErrorCode":{"type":"string","enum":["NOT_FOUND","NOT_GIT_REPO","MERGE_CONFLICT","GIT_ERROR","PATH_FORBIDDEN","INVALID_PARAM"]},"ProjectErrorResponse":{"type":"object","properties":{"error":{"allOf":[{"$ref":"#/components/schemas/ProjectErrorCode"},{"description":"Error code"}]},"message":{"type":"string","description":"Human-readable error message"}},"required":["error"]},"CreateProjectRequest":{"type":"object","properties":{"name":{"type":"string","minLength":1,"description":"Project name (used as directory name)","example":"my-new-project"},"baseDir":{"type":"string","description":"Base directory to create project in (defaults to repos path)","example":"/Users/dev/repos"},"initializeClaude":{"type":"boolean","description":"Initialize Claude Code in the project","example":false}},"required":["name"]},"CloneProjectRequest":{"type":"object","properties":{"url":{"type":"string","format":"uri","description":"Git repository URL to clone","example":"https://github.com/user/repo.git"},"baseDir":{"type":"string","description":"Base directory to clone into (defaults to repos path)","example":"/Users/dev/repos"},"initializeClaude":{"type":"boolean","description":"Initialize Claude Code in the project after cloning","example":false}},"required":["url"]},"ProjectCreateResponse":{"type":"object","properties":{"success":{"type":"boolean","enum":[true],"description":"Operation succeeded"},"path":{"type":"string","description":"Absolute path to the created project","example":"/Users/dev/repos/my-new-project"},"initialized":{"type":"boolean","description":"Whether Claude Code was initialized","example":false}},"required":["success","path","initialized"]},"ProjectDeleteResponse":{"type":"object","properties":{"success":{"type":"boolean","enum":[true],"description":"Project deleted successfully"}},"required":["success"]},"ProjectCreateErrorCode":{"type":"string","enum":["INVALID_JSON","INVALID_NAME","INVALID_URL","ALREADY_EXISTS","GIT_ERROR","CLAUDE_INIT_FAILED","NOT_FOUND","DELETE_FAILED"]},"ProjectCreateErrorResponse":{"type":"object","properties":{"error":{"allOf":[{"$ref":"#/components/schemas/ProjectCreateErrorCode"},{"description":"Error code"}]},"message":{"type":"string","description":"Human-readable error message"}},"required":["error"]},"ImageInfo":{"type":"object","properties":{"id":{"type":"string","description":"Image ID (prefixed with img_)","example":"img_abc123"},"mimeType":{"type":"string","description":"MIME type of the image","example":"image/png"},"size":{"type":"integer","description":"Size in bytes","example":102400},"createdAt":{"type":"string","description":"ISO 8601 creation timestamp","example":"2024-01-15T10:30:00Z"}},"required":["id","mimeType","size","createdAt"]},"ImageUploadResponse":{"type":"object","properties":{"id":{"type":"string","description":"Uploaded image ID","example":"img_abc123"},"size":{"type":"integer","description":"Size in bytes","example":102400},"agentId":{"type":"string","description":"Agent ID the image belongs to","example":"agent_xyz789"},"mimeType":{"type":"string","description":"MIME type of the image","example":"image/png"}},"required":["id","size","agentId","mimeType"]},"ImageListResponse":{"type":"object","properties":{"images":{"type":"array","items":{"$ref":"#/components/schemas/ImageInfo"},"description":"List of images for the agent"}},"required":["images"]},"ImageJsonUpload":{"type":"object","properties":{"data":{"type":"string","description":"Base64-encoded image data"},"mimeType":{"type":"string","description":"MIME type (optional, detected from data if not provided)","example":"image/png"}},"required":["data"]},"ImageErrorCode":{"type":"string","enum":["AGENT_NOT_FOUND","MISSING_IMAGE","INVALID_MIME_TYPE","IMAGE_TOO_LARGE","REQUEST_TOO_LARGE","UPLOAD_FAILED","LIST_FAILED","INVALID_CONTENT_TYPE","MISSING_DATA"]},"ImageErrorResponse":{"type":"object","properties":{"error":{"type":"string","description":"Error message"},"code":{"allOf":[{"$ref":"#/components/schemas/ImageErrorCode"},{"description":"Error code"}]}},"required":["error","code"]},"HealthResponse":{"type":"object","properties":{"status":{"type":"string","enum":["ok"],"description":"Server status","example":"ok"},"agents":{"type":"integer","description":"Active agent count","example":2},"uptime":{"type":"integer","description":"Seconds since server start","example":3600},"version":{"type":"string","description":"Server version from deno.json","example":"0.3.8"}},"required":["status","agents","uptime","version"]},"MetricsResponse":{"type":"object","properties":{"uptime":{"type":"integer","description":"Seconds since server start","example":3600},"version":{"type":"string","description":"Server version","example":"0.3.8"},"agents":{"type":"integer","description":"Active agent count","example":2}},"required":["uptime","version","agents"]},"Model":{"type":"object","properties":{"id":{"type":"string","description":"Model identifier","example":"claude-sonnet-4-20250514"},"contextWindow":{"type":"integer","description":"Context window size in tokens","example":200000}},"required":["id","contextWindow"]},"ModelsListResponse":{"type":"object","properties":{"models":{"type":"array","items":{"$ref":"#/components/schemas/Model"},"description":"Available Claude models"}},"required":["models"]},"ThinkingMode":{"type":"object","properties":{"id":{"type":"string","description":"Mode identifier","example":"think"},"name":{"type":"string","description":"Human-readable name","example":"Think"},"description":{"type":"string","description":"Mode description","example":"Standard extended thinking"},"phrase":{"type":"string","description":"Phrase appended to message","example":"Think step by step."},"budget":{"type":"integer","description":"Relative thinking budget (higher = more thinking)","example":10000}},"required":["id","name","description","phrase","budget"]},"ThinkingModesListResponse":{"type":"object","properties":{"modes":{"type":"array","items":{"$ref":"#/components/schemas/ThinkingMode"},"description":"Available thinking modes"}},"required":["modes"]},"SessionMetadata":{"type":"object","properties":{"id":{"type":"string","format":"uuid","description":"Claude's native UUID","example":"550e8400-e29b-41d4-a716-446655440000"},"projectPath":{"type":"string","description":"Absolute project path","example":"/Users/dev/my-project"},"source":{"type":"string","enum":["user","agent","helper"],"description":"Who created this session","example":"user"},"createdAt":{"type":"string","format":"date-time","description":"When session was created"},"lastActivityAt":{"type":"string","format":"date-time","description":"Last message timestamp"},"messageCount":{"type":"integer","description":"Number of messages","example":42},"lastUserMessage":{"type":"string","description":"Last user message (truncated to 200 chars)"},"lastAssistantMessage":{"type":"string","description":"Last assistant message (truncated to 200 chars)"},"title":{"type":"string","description":"First user message or AI-generated title"},"customTitle":{"type":"string","nullable":true,"description":"User-assigned custom title (overrides title)"},"model":{"type":"string","description":"Claude model used","example":"claude-sonnet-4-20250514"},"archivedAt":{"type":"string","format":"date-time","description":"When archived (soft delete)"},"parentSessionId":{"type":"string","format":"uuid","description":"Parent session UUID for lineage tracking"}},"required":["id","projectPath","source","lastActivityAt","messageCount"]},"RecentSessionsResponse":{"type":"object","properties":{"sessions":{"type":"array","items":{"$ref":"#/components/schemas/SessionMetadata"},"description":"Recent sessions across all projects"}},"required":["sessions"]},"SessionListResult":{"type":"object","properties":{"sessions":{"type":"array","items":{"$ref":"#/components/schemas/SessionMetadata"},"description":"List of sessions"},"total":{"type":"integer","description":"Total sessions matching filter","example":42},"hasMore":{"type":"boolean","description":"Whether more sessions exist","example":true}},"required":["sessions","total","hasMore"]},"SessionCountResult":{"type":"object","properties":{"total":{"type":"integer","description":"Total session count"},"count":{"type":"integer","description":"Count for specific source"},"source":{"type":"string","description":"Source filter applied"},"user":{"type":"integer","description":"User session count"},"agent":{"type":"integer","description":"Agent session count"},"helper":{"type":"integer","description":"Helper session count"}}},"PaginatedMessage":{"type":"object","properties":{"id":{"type":"string","description":"Message ID"},"timestamp":{"type":"string","description":"Message timestamp"},"message":{"allOf":[{"$ref":"#/components/schemas/StreamMessage"},{"description":"Typed message content (discriminated union on 'type' field)"}]},"rawContent":{"type":"array","items":{"$ref":"#/components/schemas/ContentBlock"},"description":"Structured content blocks (text, tool_use, tool_result)"}},"required":["id","timestamp","message"]},"GetMessagesResponse":{"type":"object","properties":{"apiVersion":{"type":"string","enum":["2.0"],"description":"API version"},"messages":{"type":"array","items":{"$ref":"#/components/schemas/PaginatedMessage"},"description":"Paginated messages"},"pagination":{"type":"object","properties":{"total":{"type":"integer"},"limit":{"type":"integer"},"offset":{"type":"integer"},"hasMore":{"type":"boolean"},"nextCursor":{"type":"string"},"prevCursor":{"type":"string"}},"required":["total","limit","offset","hasMore"],"description":"Pagination info"},"filters":{"type":"object","properties":{"types":{"type":"array","items":{"type":"string"}},"order":{"type":"string","enum":["asc","desc"]},"denormalize":{"type":"boolean"}},"required":["types","order","denormalize"],"description":"Applied filters"},"integrity":{"allOf":[{"$ref":"#/components/schemas/IntegrityInfo"},{"description":"Data integrity information"}]},"error":{"allOf":[{"$ref":"#/components/schemas/PaginationError"},{"description":"Pagination error details"}]}},"required":["apiVersion","messages","pagination","filters"]},"SessionUpdateBody":{"type":"object","properties":{"title":{"type":"string","nullable":true,"description":"Custom title for the session"},"customTitle":{"type":"string","nullable":true,"description":"Legacy: Custom title (prefer 'title')"}}},"DeleteResult":{"type":"object","properties":{"deleted":{"anyOf":[{"type":"boolean"},{"type":"integer"}],"description":"True if deleted, or count of deleted sessions"}},"required":["deleted"]},"BulkOperationRequest":{"type":"object","properties":{"sessionIds":{"type":"array","items":{"type":"string","format":"uuid"},"minItems":1,"maxItems":100,"description":"Session IDs to operate on (1-100)"},"operation":{"type":"object","properties":{"action":{"type":"string","enum":["archive","unarchive","delete","update"],"description":"Operation to perform"},"customTitle":{"type":"string","nullable":true,"description":"Title for update operations"}},"required":["action"],"description":"Operation to perform"}},"required":["sessionIds","operation"]},"AgentCreated":{"type":"object","properties":{"id":{"type":"string","description":"Agent ID","example":"agent_abc123"},"projectPath":{"type":"string","description":"Project path"},"sessionId":{"type":"string","description":"Session ID"},"model":{"type":"string","description":"Model ID"},"state":{"type":"string","enum":["starting","idle","running","waiting_permission","waiting_input","recovering","stopped"],"description":"Agent state"},"isHelper":{"type":"boolean","description":"Is helper agent"},"createdAt":{"type":"string","format":"date-time","description":"Creation timestamp"}},"required":["id","projectPath","sessionId","model","state","isHelper","createdAt"]},"AgentCreateBody":{"type":"object","properties":{"projectPath":{"type":"string","minLength":1,"description":"Absolute path to the project directory","example":"/Users/dev/my-project"},"sessionId":{"type":"string","format":"uuid","description":"Session ID to resume (optional)"},"model":{"type":"string","description":"Model alias (opus, sonnet, haiku)","example":"sonnet"},"helper":{"type":"boolean","description":"Create as helper agent (non-interactive)"}},"required":["projectPath"]},"AgentListItem":{"type":"object","properties":{"id":{"type":"string","description":"Agent ID"},"projectPath":{"type":"string","description":"Project path"},"sessionId":{"type":"string","description":"Session ID"},"model":{"type":"string","description":"Model ID"},"state":{"type":"string","enum":["starting","idle","running","waiting_permission","waiting_input","recovering","stopped"],"description":"Agent state"},"isHelper":{"type":"boolean","description":"Is helper agent"},"createdAt":{"type":"string","format":"date-time","description":"Creation timestamp"},"lastActivityAt":{"type":"string","format":"date-time","description":"Last activity timestamp"},"hasActiveConnection":{"type":"boolean","description":"Has active WebSocket connection"}},"required":["id","projectPath","sessionId","model","state","isHelper","createdAt","lastActivityAt","hasActiveConnection"]},"AgentListResponse":{"type":"object","properties":{"agents":{"type":"array","items":{"$ref":"#/components/schemas/AgentListItem"},"description":"List of agents"}},"required":["agents"]},"AgentDetail":{"type":"object","properties":{"id":{"type":"string","description":"Agent ID"},"projectPath":{"type":"string","description":"Project path"},"sessionId":{"type":"string","description":"Session ID"},"model":{"type":"string","description":"Model ID"},"state":{"type":"string","enum":["starting","idle","running","waiting_permission","waiting_input","recovering","stopped"],"description":"Agent state"},"permissionMode":{"type":"string","enum":["default","acceptEdits","bypassPermissions"],"description":"Permission mode"},"isHelper":{"type":"boolean","description":"Is helper agent"},"createdAt":{"type":"string","format":"date-time","description":"Creation timestamp"},"lastActivityAt":{"type":"string","format":"date-time","description":"Last activity timestamp"},"hasPendingPermission":{"type":"boolean","description":"Waiting for permission approval"},"hasPendingQuestion":{"type":"boolean","description":"Waiting for question answer"},"hasQueuedInput":{"type":"boolean","description":"Has queued user input"}},"required":["id","projectPath","sessionId","model","state","permissionMode","isHelper","createdAt","lastActivityAt","hasPendingPermission","hasPendingQuestion","hasQueuedInput"]},"AgentDeleteResult":{"type":"object","properties":{"deleted":{"type":"boolean","description":"Whether the agent was deleted"}},"required":["deleted"]}},"parameters":{}},"paths":{"/health":{"get":{"tags":["Status"],"summary":"Health check","description":"Returns server status, active agent count, uptime, and version.","responses":{"200":{"description":"Server is healthy","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HealthResponse"}}}}}}},"/metrics":{"get":{"tags":["Status"],"summary":"Server metrics","description":"Returns basic server metrics including uptime and agent count.","responses":{"200":{"description":"Server metrics","content":{"application/json":{"schema":{"$ref":"#/components/schemas/MetricsResponse"}}}}}}},"/config/models":{"get":{"tags":["Configuration"],"summary":"List available models","description":"Returns a list of available Claude models with their context window sizes.","responses":{"200":{"description":"Available models","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ModelsListResponse"}}}}}}},"/config/thinking-modes":{"get":{"tags":["Configuration"],"summary":"List thinking modes","description":"Returns available thinking modes ordered by increasing thinking budget.","responses":{"200":{"description":"Available thinking modes","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ThinkingModesListResponse"}}}}}}},"/projects":{"get":{"tags":["Projects"],"summary":"List all projects","description":"Returns a list of all discovered projects with their Git status and session counts.","responses":{"200":{"description":"List of projects","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProjectListResponse"}}}}}}},"/projects/{encodedPath}":{"get":{"tags":["Projects"],"summary":"Get project details","description":"Returns details for a specific project by its encoded path.","parameters":[{"schema":{"type":"string","minLength":1,"description":"URL-encoded absolute project path","example":"test-my-project"},"required":true,"name":"encodedPath","in":"path"}],"responses":{"200":{"description":"Project details","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Project"}}}},"404":{"description":"Project not found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}}}},"delete":{"tags":["Projects"],"summary":"Delete project","description":"Delete a project from the project list. Optionally delete files from disk.","parameters":[{"schema":{"type":"string","minLength":1,"description":"URL-encoded absolute project path","example":"test-my-project"},"required":true,"name":"encodedPath","in":"path"},{"schema":{"type":"boolean","nullable":true,"description":"Also delete project files from disk","example":false},"required":false,"name":"deleteFiles","in":"query"}],"responses":{"200":{"description":"Project deleted","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProjectDeleteResponse"}}}},"404":{"description":"Project not found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProjectCreateErrorResponse"}}}},"500":{"description":"Delete operation failed","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProjectCreateErrorResponse"}}}}}}},"/projects/refresh":{"post":{"tags":["Projects"],"summary":"Refresh project list","description":"Invalidate project cache and rescan for projects.","responses":{"200":{"description":"Updated list of projects","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProjectListResponse"}}}}}}},"/projects/{encodedPath}/git/pull":{"post":{"tags":["Projects"],"summary":"Pull latest changes","description":"Fetch and merge changes from remote repository.","parameters":[{"schema":{"type":"string","minLength":1,"description":"URL-encoded absolute project path","example":"test-my-project"},"required":true,"name":"encodedPath","in":"path"}],"responses":{"200":{"description":"Pull result","content":{"application/json":{"schema":{"$ref":"#/components/schemas/GitPullResult"}}}},"400":{"description":"Not a git repository","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProjectErrorResponse"}}}},"404":{"description":"Project not found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"409":{"description":"Merge conflict","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProjectErrorResponse"}}}},"502":{"description":"Git operation failed","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProjectErrorResponse"}}}}}}},"/projects/{encodedPath}/subrepos":{"get":{"tags":["Projects"],"summary":"List sub-repositories","description":"Discover git repositories nested within a project (monorepo support).","parameters":[{"schema":{"type":"string","minLength":1,"description":"URL-encoded absolute project path","example":"test-my-project"},"required":true,"name":"encodedPath","in":"path"},{"schema":{"type":"integer","minimum":1,"maximum":10,"default":2,"description":"Maximum depth to scan for sub-repositories (1-10)","example":2},"required":false,"name":"maxDepth","in":"query"}],"responses":{"200":{"description":"List of sub-repositories","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SubReposListResponse"}}}},"400":{"description":"Invalid parameters","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProjectErrorResponse"}}}},"404":{"description":"Project not found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}}}}},"/projects/{encodedPath}/subrepos/{relativePath}/pull":{"post":{"tags":["Projects"],"summary":"Pull sub-repository","description":"Pull latest changes for a specific sub-repository.","parameters":[{"schema":{"type":"string","minLength":1,"description":"URL-encoded absolute project path","example":"test-my-project"},"required":true,"name":"encodedPath","in":"path"},{"schema":{"type":"string","minLength":1,"description":"URL-encoded relative path to subrepo","example":"packages%2Fui"},"required":true,"name":"relativePath","in":"path"}],"responses":{"200":{"description":"Pull result","content":{"application/json":{"schema":{"$ref":"#/components/schemas/GitPullResult"}}}},"400":{"description":"Not a git repository","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProjectErrorResponse"}}}},"403":{"description":"Path forbidden (outside project)","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProjectErrorResponse"}}}},"404":{"description":"Project not found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"409":{"description":"Merge conflict","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProjectErrorResponse"}}}},"502":{"description":"Git operation failed","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProjectErrorResponse"}}}}}}},"/projects/create":{"post":{"tags":["Projects"],"summary":"Create project","description":"Create a new project directory with optional Git and Claude Code initialization.","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateProjectRequest"}}}},"responses":{"201":{"description":"Project created","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProjectCreateResponse"}}}},"400":{"description":"Invalid request (bad name or JSON)","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProjectCreateErrorResponse"}}}},"409":{"description":"Project already exists","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProjectCreateErrorResponse"}}}},"502":{"description":"Git or Claude initialization failed","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProjectCreateErrorResponse"}}}}}}},"/projects/clone":{"post":{"tags":["Projects"],"summary":"Clone repository","description":"Clone a Git repository with optional Claude Code initialization.","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CloneProjectRequest"}}}},"responses":{"201":{"description":"Repository cloned","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProjectCreateResponse"}}}},"400":{"description":"Invalid request (bad URL or JSON)","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProjectCreateErrorResponse"}}}},"409":{"description":"Project already exists","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProjectCreateErrorResponse"}}}},"502":{"description":"Git or Claude initialization failed","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProjectCreateErrorResponse"}}}}}}},"/sessions/recent":{"get":{"tags":["Sessions"],"summary":"List recent sessions","description":"Returns recent sessions across all projects, sorted by last activity.","parameters":[{"schema":{"type":"integer","minimum":1,"maximum":50,"default":10,"description":"Maximum sessions to return (max 50)","example":10},"required":false,"name":"limit","in":"query"},{"schema":{"type":"string","description":"Filter by source","example":"user"},"required":false,"name":"source","in":"query"}],"responses":{"200":{"description":"Recent sessions","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RecentSessionsResponse"}}}}}}},"/projects/{encodedPath}/sessions":{"get":{"tags":["Sessions"],"summary":"List project sessions","description":"Returns paginated sessions for a project with optional filtering.","parameters":[{"schema":{"type":"string","minLength":1,"description":"URL-encoded absolute project path","example":"test-my-project"},"required":true,"name":"encodedPath","in":"path"},{"schema":{"type":"integer","minimum":1,"maximum":100,"default":50,"description":"Maximum sessions to return","example":50},"required":false,"name":"limit","in":"query"},{"schema":{"type":"integer","nullable":true,"minimum":0,"default":0,"description":"Sessions to skip","example":0},"required":false,"name":"offset","in":"query"},{"schema":{"type":"string","description":"Filter by source (user, agent, helper, all, or comma-separated)","example":"user"},"required":false,"name":"source","in":"query"},{"schema":{"type":"boolean","nullable":true,"default":false,"description":"Include archived sessions"},"required":false,"name":"includeArchived","in":"query"},{"schema":{"type":"boolean","nullable":true,"default":false,"description":"Only return archived sessions"},"required":false,"name":"archivedOnly","in":"query"},{"schema":{"type":"string","format":"uuid","description":"Filter by parent session"},"required":false,"name":"parentSessionId","in":"query"}],"responses":{"200":{"description":"Session list","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SessionListResult"}}}}}},"delete":{"tags":["Sessions"],"summary":"Bulk delete sessions","description":"Delete multiple sessions by filter: older_than (days), source, agent_older_than (hours), or empty.","parameters":[{"schema":{"type":"string","minLength":1,"description":"URL-encoded absolute project path","example":"test-my-project"},"required":true,"name":"encodedPath","in":"path"},{"schema":{"type":"string","enum":["older_than","source","agent_older_than","empty"],"description":"Delete filter type"},"required":true,"name":"filter","in":"query"},{"schema":{"type":"integer","nullable":true,"description":"Days for older_than filter"},"required":false,"name":"days","in":"query"},{"schema":{"type":"integer","nullable":true,"description":"Hours for agent_older_than filter"},"required":false,"name":"hours","in":"query"},{"schema":{"type":"string","enum":["user","agent","helper"],"description":"Source for source filter"},"required":false,"name":"source","in":"query"}],"responses":{"200":{"description":"Sessions deleted","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DeleteResult"}}}},"400":{"description":"Invalid filter parameters","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}}}}},"/projects/{encodedPath}/sessions/count":{"get":{"tags":["Sessions"],"summary":"Count sessions","description":"Returns session count by source. Much faster than fetching full list.","parameters":[{"schema":{"type":"string","minLength":1,"description":"URL-encoded absolute project path","example":"test-my-project"},"required":true,"name":"encodedPath","in":"path"},{"schema":{"type":"string","description":"Filter by source"},"required":false,"name":"source","in":"query"}],"responses":{"200":{"description":"Session counts","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SessionCountResult"}}}}}}},"/projects/{encodedPath}/sessions/search":{"get":{"tags":["Sessions","Search"],"summary":"Search sessions in project","description":"Full-text search within a specific project's sessions.","parameters":[{"schema":{"type":"string","minLength":1,"description":"URL-encoded absolute project path","example":"test-my-project"},"required":true,"name":"encodedPath","in":"path"},{"schema":{"type":"string","minLength":1,"description":"Search query","example":"implement feature"},"required":true,"name":"q","in":"query"},{"schema":{"type":"integer","minimum":1,"maximum":100,"description":"Maximum results"},"required":false,"name":"limit","in":"query"},{"schema":{"type":"integer","nullable":true,"minimum":0,"description":"Results to skip"},"required":false,"name":"offset","in":"query"}],"responses":{"200":{"description":"Search results","content":{"application/json":{"schema":{"allOf":[{"$ref":"#/components/schemas/SearchResponse"},{"properties":{"query":{"type":"string","description":"Search query"},"results":{"type":"array","items":{"allOf":[{"$ref":"#/components/schemas/SearchResult"},{"properties":{"sessionId":{"type":"string","description":"Matched session ID"},"projectPath":{"type":"string","description":"Project path"},"score":{"type":"number","description":"Relevance score"},"snippets":{"type":"array","items":{"allOf":[{"$ref":"#/components/schemas/SearchSnippet"},{"properties":{"type":{"type":"string","description":"Message type (user, assistant, etc.)"},"text":{"type":"string","description":"Snippet text with context"},"matchStart":{"type":"integer","description":"Character offset of match start"},"matchLength":{"type":"integer","description":"Length of match"}}}]},"description":"Matched text snippets"},"timestamp":{"type":"string","description":"Session timestamp"}},"required":["sessionId","projectPath","score","snippets","timestamp"]}]},"description":"Search results"},"total":{"type":"integer","description":"Total matches"},"hasMore":{"type":"boolean","description":"More results available"}},"required":["results","total","hasMore"]}]}}}},"400":{"description":"Invalid parameters","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}}}}},"/projects/{encodedPath}/sessions/{sessionId}":{"get":{"tags":["Sessions"],"summary":"Get session details","description":"Returns metadata for a specific session.","parameters":[{"schema":{"type":"string","minLength":1,"description":"URL-encoded absolute project path","example":"test-my-project"},"required":true,"name":"encodedPath","in":"path"},{"schema":{"type":"string","minLength":1,"description":"Session UUID","example":"550e8400-e29b-41d4-a716-446655440000"},"required":true,"name":"sessionId","in":"path"}],"responses":{"200":{"description":"Session details","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SessionMetadata"}}}},"404":{"description":"Session not found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}}}},"put":{"tags":["Sessions"],"summary":"Update session","description":"Update session properties like custom title.","parameters":[{"schema":{"type":"string","minLength":1,"description":"URL-encoded absolute project path","example":"test-my-project"},"required":true,"name":"encodedPath","in":"path"},{"schema":{"type":"string","minLength":1,"description":"Session UUID","example":"550e8400-e29b-41d4-a716-446655440000"},"required":true,"name":"sessionId","in":"path"}],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/SessionUpdateBody"}}}},"responses":{"200":{"description":"Updated session","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SessionMetadata"}}}},"400":{"description":"Invalid request body","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"404":{"description":"Session not found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}}}},"delete":{"tags":["Sessions"],"summary":"Delete session","description":"Permanently delete a session and its history.","parameters":[{"schema":{"type":"string","minLength":1,"description":"URL-encoded absolute project path","example":"test-my-project"},"required":true,"name":"encodedPath","in":"path"},{"schema":{"type":"string","minLength":1,"description":"Session UUID","example":"550e8400-e29b-41d4-a716-446655440000"},"required":true,"name":"sessionId","in":"path"}],"responses":{"200":{"description":"Session deleted","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DeleteResult"}}}},"404":{"description":"Session not found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}}}}},"/projects/{encodedPath}/sessions/{sessionId}/children":{"get":{"tags":["Sessions"],"summary":"Get child sessions","description":"Returns sessions that have this session as their parent (subagent sessions).","parameters":[{"schema":{"type":"string","minLength":1,"description":"URL-encoded absolute project path","example":"test-my-project"},"required":true,"name":"encodedPath","in":"path"},{"schema":{"type":"string","minLength":1,"description":"Session UUID","example":"550e8400-e29b-41d4-a716-446655440000"},"required":true,"name":"sessionId","in":"path"},{"schema":{"type":"integer","minimum":1,"maximum":100,"default":50},"required":false,"name":"limit","in":"query"},{"schema":{"type":"integer","nullable":true,"minimum":0,"default":0},"required":false,"name":"offset","in":"query"}],"responses":{"200":{"description":"Child sessions","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SessionListResult"}}}}}}},"/projects/{encodedPath}/sessions/{sessionId}/export":{"get":{"tags":["Sessions"],"summary":"Export session","description":"Exports session content in markdown or JSON format.","parameters":[{"schema":{"type":"string","minLength":1,"description":"URL-encoded absolute project path","example":"test-my-project"},"required":true,"name":"encodedPath","in":"path"},{"schema":{"type":"string","minLength":1,"description":"Session UUID","example":"550e8400-e29b-41d4-a716-446655440000"},"required":true,"name":"sessionId","in":"path"},{"schema":{"type":"string","default":"markdown","description":"Export format (markdown or json)","example":"markdown"},"required":false,"name":"format","in":"query"},{"schema":{"anyOf":[{"type":"boolean"},{"type":"string"}],"default":false,"description":"Exclude thinking content"},"required":false,"name":"excludeThinking","in":"query"},{"schema":{"anyOf":[{"type":"boolean"},{"type":"string"}],"default":false,"description":"Include structured content blocks"},"required":false,"name":"includeStructuredContent","in":"query"}],"responses":{"200":{"description":"Exported session content","content":{"text/markdown":{"schema":{"type":"string"}},"application/json":{"schema":{"nullable":true}}}},"400":{"description":"Invalid format","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"404":{"description":"Session not found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}}}}},"/projects/{encodedPath}/sessions/{sessionId}/messages":{"get":{"tags":["Sessions","Messages"],"summary":"Get paginated messages","description":"Returns paginated messages with cursor or offset-based pagination. Default order is newest-first.","parameters":[{"schema":{"type":"string","minLength":1,"description":"URL-encoded absolute project path","example":"test-my-project"},"required":true,"name":"encodedPath","in":"path"},{"schema":{"type":"string","minLength":1,"description":"Session UUID","example":"550e8400-e29b-41d4-a716-446655440000"},"required":true,"name":"sessionId","in":"path"},{"schema":{"type":"string","format":"uuid","description":"Cursor: fetch messages before this ID"},"required":false,"name":"before","in":"query"},{"schema":{"type":"string","format":"uuid","description":"Cursor: fetch messages after this ID"},"required":false,"name":"after","in":"query"},{"schema":{"type":"integer","minimum":1,"maximum":100,"default":25,"description":"Maximum messages to return","example":25},"required":false,"name":"limit","in":"query"},{"schema":{"type":"integer","nullable":true,"minimum":0,"description":"Messages to skip (cannot use with cursors)"},"required":false,"name":"offset","in":"query"},{"schema":{"type":"string","description":"Comma-separated message types filter","example":"user,assistant"},"required":false,"name":"types","in":"query"},{"schema":{"type":"string","enum":["asc","desc"],"default":"desc","description":"Sort order (desc = newest first)"},"required":false,"name":"order","in":"query"},{"schema":{"anyOf":[{"type":"boolean"},{"type":"string"}],"default":true,"description":"Merge tool_use and tool_result into assistant messages"},"required":false,"name":"denormalize","in":"query"},{"schema":{"anyOf":[{"type":"boolean"},{"type":"string"}],"default":false,"description":"Include structured content blocks"},"required":false,"name":"includeRawContent","in":"query"}],"responses":{"200":{"description":"Paginated messages","content":{"application/json":{"schema":{"$ref":"#/components/schemas/GetMessagesResponse"}}}},"400":{"description":"Invalid parameters","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"404":{"description":"Session not found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"429":{"description":"Rate limited","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"500":{"description":"Internal error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}}}}},"/projects/{encodedPath}/sessions/{sessionId}/archive":{"post":{"tags":["Sessions"],"summary":"Archive session","description":"Soft-delete a session by marking it as archived.","parameters":[{"schema":{"type":"string","minLength":1,"description":"URL-encoded absolute project path","example":"test-my-project"},"required":true,"name":"encodedPath","in":"path"},{"schema":{"type":"string","minLength":1,"description":"Session UUID","example":"550e8400-e29b-41d4-a716-446655440000"},"required":true,"name":"sessionId","in":"path"}],"responses":{"200":{"description":"Archived session","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SessionMetadata"}}}},"404":{"description":"Session not found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}}}}},"/projects/{encodedPath}/sessions/{sessionId}/unarchive":{"post":{"tags":["Sessions"],"summary":"Unarchive session","description":"Restore an archived session.","parameters":[{"schema":{"type":"string","minLength":1,"description":"URL-encoded absolute project path","example":"test-my-project"},"required":true,"name":"encodedPath","in":"path"},{"schema":{"type":"string","minLength":1,"description":"Session UUID","example":"550e8400-e29b-41d4-a716-446655440000"},"required":true,"name":"sessionId","in":"path"}],"responses":{"200":{"description":"Unarchived session","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SessionMetadata"}}}},"404":{"description":"Session not found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}}}}},"/projects/{encodedPath}/sessions/bulk":{"post":{"tags":["Sessions"],"summary":"Bulk session operations","description":"Perform bulk operations (archive, unarchive, delete, update) on multiple sessions.","parameters":[{"schema":{"type":"string","minLength":1,"description":"URL-encoded absolute project path","example":"test-my-project"},"required":true,"name":"encodedPath","in":"path"}],"requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/BulkOperationRequest"}}}},"responses":{"200":{"description":"Bulk operation result","content":{"application/json":{"schema":{"allOf":[{"$ref":"#/components/schemas/BulkOperationResult"},{"properties":{"success":{"type":"array","items":{"type":"string"},"description":"Successfully processed session IDs"},"failed":{"type":"array","items":{"type":"object","properties":{"sessionId":{"type":"string"},"error":{"type":"string"}},"required":["sessionId","error"]},"description":"Failed operations with error details"}}}]}}}},"400":{"description":"Invalid request","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}}}}},"/agents":{"post":{"tags":["Agents"],"summary":"Create agent","description":"Create a new Claude agent for a project.","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/AgentCreateBody"}}}},"responses":{"201":{"description":"Agent created","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AgentCreated"}}}},"400":{"description":"Invalid request","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"429":{"description":"Max agents reached","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}},"500":{"description":"Failed to create agent","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}}}},"get":{"tags":["Agents"],"summary":"List agents","description":"List all active agents.","responses":{"200":{"description":"List of agents","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AgentListResponse"}}}}}}},"/agents/{agentId}":{"get":{"tags":["Agents"],"summary":"Get agent details","description":"Get detailed information about a specific agent.","parameters":[{"schema":{"type":"string","description":"Agent ID","example":"agent_abc123"},"required":true,"name":"agentId","in":"path"}],"responses":{"200":{"description":"Agent details","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AgentDetail"}}}},"404":{"description":"Agent not found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}}}},"delete":{"tags":["Agents"],"summary":"Delete agent","description":"Stop and delete an agent.","parameters":[{"schema":{"type":"string","description":"Agent ID","example":"agent_abc123"},"required":true,"name":"agentId","in":"path"}],"responses":{"200":{"description":"Agent deleted","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AgentDeleteResult"}}}},"404":{"description":"Agent not found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Error"}}}}}}},"/api/push/register":{"post":{"tags":["Push"],"summary":"Register FCM token","description":"Register a Firebase Cloud Messaging token for push notifications.","security":[{"bearerAuth":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RegisterFcmRequest"}}}},"responses":{"200":{"description":"Token registered successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RegisterFcmResponse"}}}},"400":{"description":"Invalid request","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PushErrorResponse"}}}},"401":{"description":"Authentication required","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PushErrorResponse"}}}}}}},"/api/push/live-activity":{"post":{"tags":["Push"],"summary":"Register Live Activity token","description":"Register an APNs token for iOS Live Activity updates.","security":[{"bearerAuth":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RegisterLiveActivityRequest"}}}},"responses":{"200":{"description":"Live Activity token registered successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RegisterLiveActivityResponse"}}}},"400":{"description":"Invalid request","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PushErrorResponse"}}}},"401":{"description":"Authentication required","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PushErrorResponse"}}}}}}},"/api/push/invalidate":{"delete":{"tags":["Push"],"summary":"Invalidate push token","description":"Invalidate a push token on logout or token refresh.","security":[{"bearerAuth":[]}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/InvalidateTokenRequest"}}}},"responses":{"200":{"description":"Token invalidated successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/InvalidateTokenResponse"}}}},"400":{"description":"Invalid request","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PushErrorResponse"}}}},"401":{"description":"Authentication required","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PushErrorResponse"}}}}}}},"/api/push/status":{"get":{"tags":["Push"],"summary":"Get push registration status","description":"Get current push notification registration status for the user.","security":[{"bearerAuth":[]}],"responses":{"200":{"description":"Push status retrieved successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PushStatusResponse"}}}},"401":{"description":"Authentication required","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PushErrorResponse"}}}}}}},"/projects/{encodedPath}/files":{"get":{"tags":["Files"],"summary":"List directory contents","description":"List files and directories within a project. Defaults to project root.","parameters":[{"schema":{"type":"string","minLength":1,"description":"URL-encoded absolute project path","example":"test-my-project"},"required":true,"name":"encodedPath","in":"path"},{"schema":{"type":"string","description":"Directory path relative to project root (defaults to /)","example":"/src"},"required":false,"name":"dir","in":"query"}],"responses":{"200":{"description":"Directory listing","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DirectoryListing"}}}},"400":{"description":"Invalid request (e.g., path is not a directory)","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FileErrorResponse"}}}},"403":{"description":"Path is forbidden (outside project root)","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FileErrorResponse"}}}},"404":{"description":"Project or directory not found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FileErrorResponse"}}}}}}},"/projects/{encodedPath}/files/{filePath}":{"get":{"tags":["Files"],"summary":"Get file contents","description":"Read the contents of a file within a project.","parameters":[{"schema":{"type":"string","minLength":1,"description":"URL-encoded absolute project path","example":"test-my-project"},"required":true,"name":"encodedPath","in":"path"},{"schema":{"type":"string","minLength":1,"description":"URL-encoded file path relative to project root","example":"src%2Fmain.ts"},"required":true,"name":"filePath","in":"path"}],"responses":{"200":{"description":"File contents","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FileContent"}}}},"400":{"description":"Invalid request (e.g., binary file or file too large)","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FileErrorResponse"}}}},"403":{"description":"Path is forbidden (outside project root)","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FileErrorResponse"}}}},"404":{"description":"Project or file not found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FileErrorResponse"}}}}}}},"/search":{"get":{"tags":["Search"],"summary":"Search sessions","description":"Search across sessions for keywords. Returns ranked results with matching snippets.","parameters":[{"schema":{"type":"string","minLength":1,"description":"Search query (required)","example":"authentication"},"required":true,"name":"q","in":"query"},{"schema":{"type":"string","description":"Filter by project path","example":"/Users/dev/my-project"},"required":false,"name":"project","in":"query"},{"schema":{"type":"integer","minimum":1,"maximum":100,"default":20,"description":"Maximum results to return (default: 20, max: 100)","example":20},"required":false,"name":"limit","in":"query"},{"schema":{"type":"integer","nullable":true,"minimum":0,"default":0,"description":"Offset for pagination","example":0},"required":false,"name":"offset","in":"query"}],"responses":{"200":{"description":"Search results","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SearchResponse"}}}},"400":{"description":"Invalid request","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SearchErrorResponse"}}}}}}},"/permissions":{"get":{"tags":["Permissions"],"summary":"Get permission configuration","description":"Returns the current permission configuration including global settings and per-project overrides.","responses":{"200":{"description":"Permission configuration","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PermissionConfig"}}}}}},"put":{"tags":["Permissions"],"summary":"Update permission configuration","description":"Update permission configuration. Provided settings are merged with existing configuration.","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UpdatePermissionConfig"}}}},"responses":{"200":{"description":"Configuration updated successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PermissionSuccessResponse"}}}},"400":{"description":"Invalid request body","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PermissionErrorResponse"}}}}}}},"/agents/{agentId}/upload":{"post":{"tags":["Images"],"summary":"Upload image","description":"Upload an image for an agent. Accepts multiple content types:\n- `multipart/form-data` with a file field named \"image\"\n- `application/json` with `{ data: base64, mimeType?: string }`\n- `image/*` with raw binary body","parameters":[{"schema":{"type":"string","minLength":1,"description":"Agent ID","example":"agent_xyz789"},"required":true,"name":"agentId","in":"path"}],"responses":{"200":{"description":"Image uploaded successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ImageUploadResponse"}}}},"400":{"description":"Invalid request (missing data, invalid MIME type, etc.)","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ImageErrorResponse"}}}},"404":{"description":"Agent not found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ImageErrorResponse"}}}},"413":{"description":"Image too large","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ImageErrorResponse"}}}},"415":{"description":"Unsupported content type","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ImageErrorResponse"}}}},"500":{"description":"Upload failed","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ImageErrorResponse"}}}}}}},"/agents/{agentId}/images":{"get":{"tags":["Images"],"summary":"List images","description":"List all images uploaded for an agent.","parameters":[{"schema":{"type":"string","minLength":1,"description":"Agent ID","example":"agent_xyz789"},"required":true,"name":"agentId","in":"path"}],"responses":{"200":{"description":"List of images","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ImageListResponse"}}}},"404":{"description":"Agent not found","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ImageErrorResponse"}}}},"500":{"description":"Failed to list images","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ImageErrorResponse"}}}}}}}}}